<html> 
<head> 
<title>qb - 3d puzzle game</title> 
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"> 
 
<script type="text/javascript" src="glMatrix-0.9.5.min.js"></script> 
<script type="text/javascript" src="webgl-utils.js"></script> 
 
<script id="shader-fs" type="x-shader/x-fragment"> 
    #ifdef GL_ES
    precision highp float;
    #endif
    uniform vec4 aColor;
    void main(void) {
        gl_FragColor = aColor;
    }
</script> 
 
<script id="shader-vs" type="x-shader/x-vertex"> 
    attribute vec3 aVertexPosition;
 
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
 
 
    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    }
</script> 

<script id="shader-fs-bloom" type="x-shader/x-fragment"> 
	#ifdef GL_ES\n" +
	precision highp float;
	#endif
	uniform sampler2D  sTexture;
	uniform float bloomFactor;
	varying vec2  TexCoord0;
	varying vec2  TexCoord1;
	varying vec2  TexCoord2;
	void main()
	{
		vec3 color = texture2D(sTexture, TexCoord0).rgb * 0.333333;
		color = (texture2D(sTexture, TexCoord1).rgb * 0.333333) + color;
		color = (texture2D(sTexture, TexCoord2).rgb * 0.333333) + color; 
		gl_FragColor.rgb = color*bloomFactor;
	}
</script> 
 
<script id="shader-vs-bloom" type="x-shader/x-vertex"> 
	attribute vec4 aVertexPosition;   
	attribute vec2 aTexCoord;
	uniform float TexelOffsetX;   
	uniform float TexelOffsetY;   
	varying vec2  TexCoord0;   
	varying vec2  TexCoord1;   
	varying vec2  TexCoord2;  
	void main()   
	{ 
		// Pass through vertex   
		gl_Position = aVertexPosition; 
		 
		// Calculate texture offsets and pass through	  
		vec2 offset = vec2(TexelOffsetX, TexelOffsetY);  

		TexCoord0 = aTexCoord - offset;  
		TexCoord1 = aTexCoord;  
		TexCoord2 = aTexCoord + offset;      
	} 
</script> 

<script id="shader-fs-quad" type="x-shader/x-fragment"> 
    #ifdef GL_ES
    precision highp float;
    #endif
    uniform sampler2D sTexture;
    varying vec2  texCoord;   

    void main(void) {
        gl_FragColor = texture2D(sTexture, v_texCoords);
    }
</script> 
 
<script id="shader-vs-quad" type="x-shader/x-vertex"> 
    attribute vec3 aVertexPosition;
    attribute vec2 aTexCoord;
    varying vec2  texCoord;   
 
    void main(void) {
	texCoord = aTexCoord;
        gl_Position = vec4(aVertexPosition, 1.0);
    }
</script> 
 
<script type="text/javascript"> 
 
    var gl;

	var angleX;
	var angleY;
	var deltaTime = 0;
	var level = [2.0, -6.0, -8.0,
		 2.0, -4.0, -8.0,
		 2.0, -2.0, -8.0,
		 2.0, -6.0, -6.0,
		 2.0, -2.0, -6.0,
		 2.0, -6.0, -4.0,
		 2.0, -4.0, -4.0,
		 2.0, -2.0, -4.0,
		 2.0, 0.0, -4.0,
		 2.0, -6.0, -2.0,
		 2.0, -4.0, -2.0,
		 2.0, -2.0, -2.0,
		 2.0, 0.0, -2.0,
		 -6.0, -2.0, 2.0,
		 -4.0, -2.0, 2.0,
		 -4.0, 0.0, 2.0,
		 -4.0, 2.0, 2.0,
		 -4.0, 4.0, 2.0,
		 -4.0, -2.0, 4.0,
		 -4.0, 0.0, 4.0,
		 -4.0, 4.0, 4.0,
		 -4.0, -2.0, 6.0,
		 -4.0, 4.0, 6.0,
		 -4.0, -2.0, 8.0,
		 -4.0, 0.0, 8.0,
		 -4.0, 2.0, 8.0,
		 -4.0, 4.0, 8.0];
	
    function initGL(canvas) {
        try {
            gl = canvas.getContext("experimental-webgl");
            gl.viewportWidth = canvas.width;
            gl.viewportHeight = canvas.height;
        } catch (e) {
        }
        if (!gl) {
            alert("Could not initialise WebGL, sorry :-(");
        }
    }
 
 
    function getShader(gl, id) {
        var shaderScript = document.getElementById(id);
        if (!shaderScript) {
            return null;
        }
 
        var str = "";
        var k = shaderScript.firstChild;
        while (k) {
            if (k.nodeType == 3) {
                str += k.textContent;
            }
            k = k.nextSibling;
        }
 
        var shader;
        if (shaderScript.type == "x-shader/x-fragment") {
            shader = gl.createShader(gl.FRAGMENT_SHADER);
        } else if (shaderScript.type == "x-shader/x-vertex") {
            shader = gl.createShader(gl.VERTEX_SHADER);
        } else {
            return null;
        }
 
        gl.shaderSource(shader, str);
        gl.compileShader(shader);
 
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(shader));
            return null;
        }
 
        return shader;
    }
 
 
    var shaderProgram;
 
    function initShaders() {
        var fragmentShader = getShader(gl, "shader-fs");
        var vertexShader = getShader(gl, "shader-vs");
 
        shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);
 
        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }
 
        gl.useProgram(shaderProgram);
 
        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);
  
        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
        shaderProgram.colorUniform = gl.getUniformLocation(shaderProgram, "aColor");

        fragmentShader = getShader(gl, "shader-fs");
        vertexShader = getShader(gl, "shader-vs");
 
        bloomShader = gl.createProgram();
        gl.attachShader(bloomShader, vertexShader);
        gl.attachShader(bloomShader, fragmentShader);
        gl.linkProgram(bloomShader);
 
        if (!gl.getProgramParameter(bloomShader, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }
 
        gl.useProgram(bloomShader);
 
        bloomShader.vertexPositionAttribute = gl.getAttribLocation(bloomShader, "aVertexPosition");
        gl.enableVertexAttribArray(bloomShader.vertexPositionAttribute);
		bloomShader.vertexTextureAttribute = gl.getAttribLocation(bloomShader, "aTexCoord");
        gl.enableVertexAttribArray(bloomShader.vertexPositionAttribute);
  
        bloomShader.sTextureUniform = gl.getUniformLocation(bloomShader, "sTexture");
        bloomShader.bloomFactorUniform = gl.getUniformLocation(bloomShader, "bloomFactor");
        bloomShader.texelOffsetXUniform = gl.getUniformLocation(bloomShader, "TexelOffsetX");
        bloomShader.texelOffsetYUniform = gl.getUniformLocation(bloomShader, "TexelOffsetY");
    }
 
	function initFramebuffer() {
		rttFramebuffer = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, rttFramebuffer);

		rttTexture = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, rttTexture);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		gl.generateMipmap(gl.TEXTURE_2D);

		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 128, 128, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);

		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, rttTexture, 0);

		gl.bindTexture(gl.TEXTURE_2D, null);
		gl.bindFramebuffer(gl.FRAMEBUFFER, null);

		if (!gl.isFramebuffer(rttFramebuffer)) {
			alert("Failed to create framebuffer object.");
		} else {
			console.log("Success to create framebuffer object.");
		}

		var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
		if (status != gl.FRAMEBUFFER_COMPLETE) {
			console.log("status != gl.FRAMEBUFFER_COMPLETE");
		} else {
			console.log("status == gl.FRAMEBUFFER_COMPLETE");
		}


		//and another for ping pong
		rttFramebuffer2 = gl.createFramebuffer();
		gl.bindFramebuffer(gl.FRAMEBUFFER, rttFramebuffer2);

		rttTexture2 = gl.createTexture();
		gl.bindTexture(gl.TEXTURE_2D, rttTexture);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
		gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
		gl.generateMipmap(gl.TEXTURE_2D);

		gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 128, 128, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);

		gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, rttTexture2, 0);

		gl.bindTexture(gl.TEXTURE_2D, null);
		gl.bindFramebuffer(gl.FRAMEBUFFER, null);

		if (!gl.isFramebuffer(rttFramebuffer2)) {
			alert("Failed to create framebuffer object.");
		} else {
			console.log("Success to create framebuffer object.");
		}

		var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
		if (status != gl.FRAMEBUFFER_COMPLETE) {
			console.log("status != gl.FRAMEBUFFER_COMPLETE");
		} else {
			console.log("status == gl.FRAMEBUFFER_COMPLETE");
		}
	}
 
    var mvMatrix = mat4.create();
    var pMatrix = mat4.create();
 
    function setMatrixUniforms() {
        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
        gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);
    }
 
 
    var sphereVertexPositionBuffer;
 
    function initBuffers() {
        wireCubeVertexPositionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, wireCubeVertexPositionBuffer);
		var vertices = [
				// front face
				-1.0, 1.0, 1.0, 1.0, // 0
				1.0, 1.0, 1.0, 1.0, // 1
				1.0, -1.0, 1.0, 1.0, // 2
				-1.0, -1.0, 1.0, 1.0, // 3

				// left face
				-1.0, 1.0, 1.0, 1.0, // 0
				-1.0, 1.0, -1.0, 1.0, // 4
				-1.0, -1.0, -1.0, 1.0, // 7
				-1.0, -1.0, 1.0, 1.0, // 3

				// bottom face
				-1.0, -1.0, 1.0, 1.0, // 3
				1.0, -1.0, 1.0, 1.0, // 2
				1.0, -1.0, -1.0, 1.0, // 6
				-1.0, -1.0, -1.0, 1.0, // 7

				// back face
				-1.0, -1.0, -1.0, 1.0, // 7
				-1.0, 1.0, -1.0, 1.0, // 4
				1.0, 1.0, -1.0, 1.0, // 5
				1.0, -1.0, -1.0, 1.0, // 6

				// right face
				1.0, -1.0, -1.0, 1.0, // 6
				1.0, -1.0, 1.0, 1.0, // 2
				1.0, 1.0, 1.0, 1.0, // 1
				1.0, 1.0, -1.0, 1.0, // 5
		];
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
        wireCubeVertexPositionBuffer.itemSize = 4;
        wireCubeVertexPositionBuffer.numItems = 20;

	}
 
 
    function drawScene() {
        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
 
		gl.useProgram(shaderProgram);

		mat4.identity(mvMatrix);
        mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);
 		mat4.translate(mvMatrix, [0.0, -0.0, -15.0]);
		
        gl.bindFramebuffer(gl.FRAMEBUFFER, rttFramebuffer);

		//draw Blocks		
		mvPushMatrix();		
		mat4.scale(mvMatrix, [0.5, 0.5, 0.5]);

		mat4.rotate(mvMatrix, degToRad(angleX), [1, 0, 0]);
		mat4.rotate(mvMatrix, degToRad(angleY), [0, 1, 0]);

		mat4.scale(mvMatrix, [0.95, 0.95, 0.95]);

        gl.bindBuffer(gl.ARRAY_BUFFER, wireCubeVertexPositionBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,wireCubeVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
		for(i=0;i<=81;i=i+3) {
			mvPushMatrix();
			mat4.translate(mvMatrix, [level[i+0], level[i+1], level[i+2]]);
			setMatrixUniforms();
			gl.uniform4f(shaderProgram.colorUniform, 1.0,0.0,0.0,1.0);
		   	gl.drawArrays(gl.LINE_STRIP, 0, wireCubeVertexPositionBuffer.numItems);
			mvPopMatrix();
		}
		mvPopMatrix();

        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.bindTexture(gl.TEXTURE_2D, rttTexture);
        
    }
 
 
 
    function webGLStart() {
        var canvas = document.getElementById("canvas");
        initGL(canvas);
        initShaders();
		initFramebuffer();
        initBuffers();
 
		angleY = -80;
		angleX = -10;

        gl.disable(gl.DEPTH_TEST);
 	
        tick();
    }

   var lastTime = 0;
 
    function animate() {
        var timeNow = new Date().getTime();
		
        if (lastTime != 0) {
            var elapsed = timeNow - lastTime;
			deltaTime += elapsed; 	
			angleX +=  Math.cos(deltaTime / 1000.0)/10.;
			angleY += Math.cos(deltaTime / 1000.0)/5.;
        }
        lastTime = timeNow;
    }
 
 
    function tick() {
        requestAnimFrame(tick);
        drawScene();
        animate();
    }

	var currentlyPressedKeys = {};

    function degToRad(degrees) {
        return degrees * Math.PI / 180;
    }

    var mvMatrix = mat4.create();
    var mvMatrixStack = [];
    var pMatrix = mat4.create();
 
    function mvPushMatrix() {
        var copy = mat4.create();
        mat4.set(mvMatrix, copy);
        mvMatrixStack.push(copy);
    }
 
    function mvPopMatrix() {
        if (mvMatrixStack.length == 0) {
            throw "Invalid popMatrix!";
        }
        mvMatrix = mvMatrixStack.pop();
    }
 
</script> 
 
 
</head> 
 
 
<body style="background:#000000;"> 
    

<div id="applet_container">
  <applet code="org.lwjgl.util.applet.AppletLoader" archive="lwjgl_util_applet.jar" codebase="." width="800" height="480">
  
    <param name="al_title" value="AppletStarter">
    <param name="al_main" value="de.swagner.mgcube.AppletStarter">
    <param name="al_logo" value="qb_logo.png">
    <param name="al_progressbar" value="appletprogress.gif">

    <param name="al_bgcolor" value="000000">
    <param name="al_fgcolor" value="ffffff">
    
    <param name="al_jars" value="qb.jar, gdx.jar, gdx-backend-lwjgl.jar">

    <param name="al_windows" value="gdx-natives.jar, gdx-backend-lwjgl-natives.jar">
    <param name="al_linux" value="gdx-natives.jar, gdx-backend-lwjgl-natives.jar">
    <param name="al_mac" value="gdx-natives.jar, gdx-backend-lwjgl-natives.jar">
    <param name="al_solaris" value="gdx-natives.jar, gdx-backend-lwjgl-natives.jar">
    
    <param name="codebase_lookup" value="false">

    <param name="java_arguments" value="-Dsun.java2d.noddraw=true -Dsun.awt.noerasebackground=true -Dsun.java2d.d3d=false -Dsun.java2d.opengl=false -Dsun.java2d.pmoffscreen=false -Xmx800M">
   <param name="lwjgl_arguments" value="-Dorg.lwjgl.input.Mouse.allowNegativeMouseCoords=true">
    <param name="separate_jvm" value="true">
    <param name="codebase_lookup" value="false">
  </applet>
  </div>

<br/><br/><br/>
    <h3 style="color:#fff;">Screenshots</h3>
    <div>  
    <img src="screen1.png" alt="Screenshot1" />
    </div>  
    <br/>
    <div>    
    <img src="screen2.png" alt="Screenshot2" />
    </div> 
    <br/>
    <div> 
    <img src="screen3.png" alt="Screenshot3" />
    </div>    
    <br/>
    <div> 
    <img src="screen4.png" alt="Screenshot4" />
    </div>    


    <div>    
<a href="http://market.android.com/search?q=pub:Stefan+Wagner">
      <img src="http://www.android.com/images/brand/60_avail_market_logo1.png"
           alt="Available in Android Market" />
    </a>
    </div>    
</body> 
 
</html> 
